<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Loading Data From Different Sources â€¢ DarwinShinyModules</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Loading Data From Different Sources">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DarwinShinyModules</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a01-introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/a02-using-shiny-modules-in-shiny-app.html">Using modules in a shiny app</a></li>
    <li><a class="dropdown-item" href="../articles/a03-app-builders.html">Shiny App Builders</a></li>
    <li><a class="dropdown-item" href="../articles/a04-compatibility.html">Compatibility</a></li>
    <li><a class="dropdown-item" href="../articles/a05-creating-a-new-module.html">Creating a new Module</a></li>
    <li><a class="dropdown-item" href="../articles/a06-loading-data.html">Loading Data From Different Sources</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Loading Data From Different Sources</h1>
            
      

      <div class="d-none name"><code>a06-loading-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Data can come from anywhere. <code>DarwinShinyModules</code> assumes
<em>you</em> load in the data from whatever source you like. This may be
a csv-file, a table from a database. But in the end the data is loaded
into memory in R. The intention behind this is that individual modules
are (and should be) small. But can be used in large overarching
modules.</p>
<p>In this vignette we will explore how to load in data from files and
databases, by either pre-loading the data into memory. Or by loading
data dynamically, during run time. Finally we will also show how to use
the <code>DatabaseDBI</code> and <code>DatabaseDBC</code> modules.</p>
</div>
<div class="section level2">
<h2 id="preloading-data">Preloading data<a class="anchor" aria-label="anchor" href="#preloading-data"></a>
</h2>
<div class="section level3">
<h3 id="from-a-file">From a File<a class="anchor" aria-label="anchor" href="#from-a-file"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://darwin-eu-dev.github.io/DarwinShinyModules/">DarwinShinyModules</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">tempDir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"loading_data_example"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">tempDir</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">iris</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"iris.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"mtcars.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"iris.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tableFile</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">tableFile</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-database-using-dbi">A database using <code>DBI</code><a class="anchor" aria-label="anchor" href="#a-database-using-dbi"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">driver</span> <span class="op">&lt;-</span> <span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span></span>
<span>  dbdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"database.duckdb"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbConnect.html" class="external-link">dbConnect</a></span><span class="op">(</span></span>
<span>  drv <span class="op">=</span> <span class="va">driver</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">con</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"iris"</span>,</span>
<span>  value <span class="op">=</span> <span class="va">iris</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbWriteTable.html" class="external-link">dbWriteTable</a></span><span class="op">(</span></span>
<span>  conn <span class="op">=</span> <span class="va">con</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"mtcars"</span>,</span>
<span>  value <span class="op">=</span> <span class="va">mtcars</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">iris_db</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span>src <span class="op">=</span> <span class="va">con</span>, <span class="st">"iris"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">iris_db</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tableDB</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">tableDB</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-a-database-using-databaseconnector">From a database using <code>DatabaseConnector</code><a class="anchor" aria-label="anchor" href="#from-a-database-using-databaseconnector"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/DatabaseConnector/" class="external-link">DatabaseConnector</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="st">"sqlite"</span>, </span>
<span>  server <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tempDir</span>, <span class="st">"database.sqlite"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/insertTable.html" class="external-link">insertTable</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  databaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  tableName <span class="op">=</span> <span class="st">"iris"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">iris</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/insertTable.html" class="external-link">insertTable</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  databaseSchema <span class="op">=</span> <span class="st">"main"</span>,</span>
<span>  tableName <span class="op">=</span> <span class="st">"mtcars"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">mtcars</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateQuerySql.html" class="external-link">renderTranslateQuerySql</a></span><span class="op">(</span></span>
<span>  connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>  sql <span class="op">=</span> <span class="st">"SELECT * FROM iris;"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/disconnect.html" class="external-link">disconnect</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tableDBC</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">tableDBC</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="using-a-database-in-your-module">Using a database in your module<a class="anchor" aria-label="anchor" href="#using-a-database-in-your-module"></a>
</h2>
<p>You can dynamically load data from files or a database in your own
module. The loaded data can then be used in regular
<code>DarwinShinyModule</code> modules.</p>
<p>The following examples show how to dynamically load from:</p>
<ol style="list-style-type: decimal">
<li>CSV-files</li>
<li>A database using <code>DBI</code> while maintaining the database
connection</li>
<li>A database using <code>DatabaseConnector</code>, while managing the
connection in run time.</li>
</ol>
<div class="section level3">
<h3 id="from-csv-files">From csv-files<a class="anchor" aria-label="anchor" href="#from-csv-files"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TablesFromFile</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span></span>
<span>  classname <span class="op">=</span> <span class="st">"TablesFromFile"</span>,</span>
<span>  inherit <span class="op">=</span> <span class="va">ShinyModule</span>,</span>
<span></span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">filePath</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.filePath</span> <span class="op">&lt;-</span> <span class="va">filePath</span></span>
<span>      <span class="co"># initialize the `Table` module with an empty data.frame</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="va">parentNamespace</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">namespace</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co">## Fields</span></span>
<span>    .filePath <span class="op">=</span> <span class="st">""</span>,</span>
<span>    .table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>    <span class="co">## Methods</span></span>
<span>    .UI <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>        <span class="co"># Select input to get csv-files from `tempDir`</span></span>
<span>        <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span></span>
<span>          inputId <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">namespace</span>, <span class="st">"file"</span><span class="op">)</span>,</span>
<span>          label <span class="op">=</span> <span class="st">"File"</span>,</span>
<span>          <span class="co"># Get csv-file names for `tempDir`</span></span>
<span>          choices <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="fu">getCsvFiles</span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    .server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># Trigger on the file-selector</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">file</span>, <span class="op">{</span></span>
<span>        <span class="co"># Update the data field in the `Table` module with the selected csv-file</span></span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.filePath</span>, <span class="va">input</span><span class="op">$</span><span class="va">file</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># Get all csv-files from `tempDir`</span></span>
<span>    getCsvFiles <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">allFiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.filePath</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">allFiles</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">endsWith</a></span><span class="op">(</span><span class="va">allFiles</span>, suffix <span class="op">=</span> <span class="st">".csv"</span><span class="op">)</span><span class="op">]</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">TablesFromFile</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">tempDir</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-a-database-using-dbi">From a database using <code>DBI</code><a class="anchor" aria-label="anchor" href="#from-a-database-using-dbi"></a>
</h3>
<p>In this example we maintain the connection to the database, post
run-time.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TablesFromDBI</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span></span>
<span>  classname <span class="op">=</span> <span class="st">"TablesFromDBI"</span>,</span>
<span>  inherit <span class="op">=</span> <span class="va">ShinyModule</span>,</span>
<span></span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">con</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.con</span> <span class="op">&lt;-</span> <span class="va">con</span></span>
<span>      <span class="co"># initialize the `Table` module with an empty data.frame</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="va">parentNamespace</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">namespace</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co">## Fields</span></span>
<span>    .con <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    .table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>    <span class="co">## Methods</span></span>
<span>    .UI <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>        <span class="co"># Select input to get csv-files from `tempDir`</span></span>
<span>        <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span></span>
<span>          inputId <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">namespace</span>, <span class="st">"table"</span><span class="op">)</span>,</span>
<span>          label <span class="op">=</span> <span class="st">"Table"</span>,</span>
<span>          <span class="co"># List tables from the connection</span></span>
<span>          choices <span class="op">=</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbListTables.html" class="external-link">dbListTables</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.con</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    .server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span></span>
<span>      <span class="co"># Trigger on the file-selector</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table</span>, <span class="op">{</span></span>
<span>        <span class="co"># Fetch table from DBI connection</span></span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/tbl.html" class="external-link">tbl</a></span><span class="op">(</span>src <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">.con</span>, <span class="va">input</span><span class="op">$</span><span class="va">table</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="co"># We need to collect, as the table needs to be in memory</span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">TablesFromDBI</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbDisconnect.html" class="external-link">dbDisconnect</a></span><span class="op">(</span><span class="va">con</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="from-a-database-using-databaseconnector-1">From a database using <code>DatabaseConnector</code><a class="anchor" aria-label="anchor" href="#from-a-database-using-databaseconnector-1"></a>
</h3>
<p>In this example we manage the connection to the database within run
time.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TablesFromDBC</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span></span>
<span>  classname <span class="op">=</span> <span class="st">"TablesFromDBC"</span>,</span>
<span>  inherit <span class="op">=</span> <span class="va">ShinyModule</span>,</span>
<span></span>
<span>  public <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    initialize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Save connectionDetails</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.connectionDetails</span> <span class="op">&lt;-</span> <span class="va">connectionDetails</span></span>
<span>      <span class="co"># initialize the `Table` module with an empty data.frame</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="va">parentNamespace</span> <span class="op">&lt;-</span> <span class="va">self</span><span class="op">$</span><span class="va">namespace</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span>,</span>
<span></span>
<span>  private <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co">## Fields</span></span>
<span>    .connectionDetails <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    .connection <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    .table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span></span>
<span>    <span class="co">## Methods</span></span>
<span>    .UI <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>        <span class="co"># Select input to get csv-files from `tempDir`</span></span>
<span>        <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/selectInput.html" class="external-link">selectInput</a></span><span class="op">(</span></span>
<span>          inputId <span class="op">=</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">namespace</span>, <span class="st">"table"</span><span class="op">)</span>,</span>
<span>          label <span class="op">=</span> <span class="st">"Table"</span>,</span>
<span>          <span class="co"># Initialize empty, we update once the connection is established.</span></span>
<span>          choices <span class="op">=</span> <span class="st">""</span></span>
<span>        <span class="op">)</span>,</span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    .server <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># Connect to the database if `.connection` is `NULL`</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span></span>
<span>      <span class="co"># Run the `finalize` method when the session ends &gt;&gt;this includes refreshing the session&lt;&lt;</span></span>
<span>      <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/onStop.html" class="external-link">onStop</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">finalize</span><span class="op">)</span></span>
<span></span>
<span>      <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># If we're connected to the database</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># The `updated` flag ensures we update the choices once. Otherwise we</span></span>
<span>        <span class="co"># continuously query the database for table names. Which is not desirable</span></span>
<span>        <span class="co"># for this use case. The database has a separate state, and can therefore</span></span>
<span>        <span class="co"># change at will, in a different connection. New tables could appear,</span></span>
<span>        <span class="co"># existing tables could disappear.</span></span>
<span>        <span class="va">updated</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">updated</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="co"># Update choices in select</span></span>
<span>          <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/updateSelectInput.html" class="external-link">updateSelectInput</a></span><span class="op">(</span></span>
<span>            inputId <span class="op">=</span> <span class="st">"table"</span>,</span>
<span>            choices <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="fu">fetchTableNames</span><span class="op">(</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>          <span class="va">updated</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>        <span class="op">}</span></span>
<span>  </span>
<span>        <span class="co"># Trigger on the file-selector</span></span>
<span>        <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table</span>, <span class="op">{</span></span>
<span>          <span class="co"># Only query the table when the selector is updated</span></span>
<span>          <span class="kw">if</span> <span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">table</span> <span class="op">!=</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span>
<span>            <span class="co"># Fetch table from the database</span></span>
<span>            <span class="va">private</span><span class="op">$</span><span class="va">.table</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateQuerySql.html" class="external-link">renderTranslateQuerySql</a></span><span class="op">(</span></span>
<span>              connection <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">.connection</span>,</span>
<span>              sql <span class="op">=</span> <span class="st">"SELECT * FROM @table"</span>,</span>
<span>              table <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">table</span></span>
<span>            <span class="op">)</span></span>
<span>          <span class="op">}</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># Fetches the names of the tables in SQLite</span></span>
<span>    fetchTableNames <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/renderTranslateQuerySql.html" class="external-link">renderTranslateQuerySql</a></span><span class="op">(</span></span>
<span>        connection <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">.connection</span>,</span>
<span>        sql <span class="op">=</span> <span class="st">"SELECT name FROM sqlite_master WHERE type = 'table'"</span></span>
<span>      <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>          <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">NAME</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span>,</span>
<span></span>
<span>    <span class="co"># A feature of R6 is that the `Finalize` method also runs when the object is garbage collected.</span></span>
<span>    finalize <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="co"># Disconnect from database</span></span>
<span>        <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/disconnect.html" class="external-link">disconnect</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.connection</span><span class="op">)</span></span>
<span>        <span class="co"># Set `.connection` to `NULL`</span></span>
<span>        <span class="va">private</span><span class="op">$</span><span class="va">.connection</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="va">TablesFromDBC</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/preview.html">preview</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="database-modules">Database Modules<a class="anchor" aria-label="anchor" href="#database-modules"></a>
</h2>
<p>These database modules were developed based on the previous example.
Two implementations exist as of writing, a database module using
<code>DatabaseConnector</code>, and a module using <code>DBI</code>.</p>
<p>The upside of using these modules is that they manage the connection
for you. They open the connection on start-up, and close it on
shutdown.</p>
<p>When the connection unexpectedly drops, it will also prompt the user
to re-connect to the database.</p>
<div class="section level3">
<h3 id="databasedbi">DatabaseDBI<a class="anchor" aria-label="anchor" href="#databasedbi"></a>
</h3>
<p>The <code>DatabaseDBI</code> module uses <code>DBI</code> to
interface with the database. This is ideal when you want to use
<code>dplyr</code> syntax to query a database during run-time of your
shiny app.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setup the module with the driver for the database</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DatabaseDBI.html">DatabaseDBI</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">driver</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We initialize the table modules with an empty data.frame</span></span>
<span><span class="va">irisTable</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">carTable</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="va">irisTable</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">carTable</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">db</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Run the server methods</span></span>
<span>  <span class="va">db</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span>  <span class="va">irisTable</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span>  <span class="va">carTable</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Attach tables `iris` and `mtcars` from the database</span></span>
<span>  <span class="va">db</span><span class="op">$</span><span class="fu">attachTables</span><span class="op">(</span><span class="st">"iris"</span>, <span class="st">"mtcars"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Update `data` field in `irisTable` module</span></span>
<span>  <span class="va">irisTable</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">db</span><span class="op">$</span><span class="va">tables</span><span class="op">$</span><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># We can use dplyr syntax that is supported by the driver</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      foo <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">Sepal.Length</span> <span class="op">*</span> <span class="va">.data</span><span class="op">$</span><span class="va">Sepal.Width</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># We MUST collect the data, as `DarwinShinyModules` expects the final result</span></span>
<span>    <span class="co"># to be in memory.</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">carTable</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">db</span><span class="op">$</span><span class="va">tables</span><span class="op">$</span><span class="va">mtcars</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">cyl</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean_hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">hp</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interactive.html" class="external-link">interactive</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="databasedbc">DatabaseDBC<a class="anchor" aria-label="anchor" href="#databasedbc"></a>
</h3>
<p>The <code>DatabaseDBC</code> module uses
<code>DatabaseConnector</code> to interface with the database. This is
ideal when you want to use SQL to query a database during run-time of
your shiny app.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setup the module with the ConnectionDetails of the database</span></span>
<span><span class="va">db</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/DatabaseDBC.html">DatabaseDBC</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We initialize the table modules with an empty data.frame</span></span>
<span><span class="va">irisTable</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="va">carTable</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Table.html">Table</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="va">irisTable</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">carTable</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">db</span><span class="op">$</span><span class="fu">UI</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># If we want to run code in shiny::onStop() we must do that before the</span></span>
<span>  <span class="co"># server() method.</span></span>
<span>  <span class="va">stopFun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">db</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span></span>
<span>      <span class="co"># Drop a table we create later</span></span>
<span>      sql <span class="op">=</span> <span class="st">"DROP TABLE IF EXISTS tmp_table;"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/onStop.html" class="external-link">onStop</a></span><span class="op">(</span><span class="va">stopFun</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Run the server methods</span></span>
<span>  <span class="va">db</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span>  <span class="va">irisTable</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span>  <span class="va">carTable</span><span class="op">$</span><span class="fu">server</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># query the database, we can use all arguments from DatabaseConnectors</span></span>
<span>  <span class="co">#`renderTranslateQuerySql()`</span></span>
<span>  <span class="va">irisTable</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">db</span><span class="op">$</span><span class="fu">query</span><span class="op">(</span></span>
<span>    sql <span class="op">=</span> <span class="st">"SELECT * FROM @schema.iris LIMIT 10"</span>,</span>
<span>    schema <span class="op">=</span> <span class="st">"main"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># We can also execute queries in the database</span></span>
<span>  <span class="va">db</span><span class="op">$</span><span class="fu">execute</span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">    DROP TABLE IF EXISTS tmp_table;</span></span>
<span><span class="st">    </span></span>
<span><span class="st">    SELECT</span></span>
<span><span class="st">      cyl,</span></span>
<span><span class="st">      AVG(hp) as avg_hp</span></span>
<span><span class="st">    FROM @schema.mtcars</span></span>
<span><span class="st">    GROUP BY cyl</span></span>
<span><span class="st">    INTO tmp_table;"</span>,</span>
<span>    schema <span class="op">=</span> <span class="st">"main"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Assign the result from `tmp_table` to `carTable`</span></span>
<span>  <span class="va">carTable</span><span class="op">$</span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">db</span><span class="op">$</span><span class="fu">query</span><span class="op">(</span></span>
<span>    sql <span class="op">=</span> <span class="st">"SELECT * FROM @schema.tmp_table;"</span>,</span>
<span>    schema <span class="op">=</span> <span class="st">"main"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ger Inberg, Maarten van Kessel.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
